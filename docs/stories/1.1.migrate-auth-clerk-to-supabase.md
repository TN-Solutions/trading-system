# Story 1.1: Migrate Authentication from Clerk to Supabase Auth

## Status
Approved

## Story
**As a** new user,
**I want** to be able to register and log in securely using Supabase,
**so that** my account and data are protected.

## Acceptance Criteria
1. Clerk is removed from the application
2. Supabase Auth is integrated and functional
3. Middleware is updated to work with Supabase Auth
4. Users can register/login/logout successfully

## Tasks / Subtasks
- [ ] Remove Clerk dependencies and configuration (AC: 1)
  - [ ] Remove Clerk packages from package.json
  - [ ] Remove Clerk environment variables
  - [ ] Remove Clerk provider and components
- [ ] Install and configure Supabase Auth (AC: 2)
  - [ ] Install @supabase/supabase-js and @supabase/ssr packages
  - [ ] Set up Supabase client configuration
  - [ ] Configure Supabase environment variables
- [ ] Update authentication middleware (AC: 3)
  - [ ] Modify frontend/src/middleware.ts to use Supabase Auth
  - [ ] Update protected route logic
  - [ ] Handle authentication redirects
- [ ] Create authentication components (AC: 4)
  - [ ] Build sign-in form component
  - [ ] Build sign-up form component
  - [ ] Implement logout functionality
- [ ] Update authentication pages (AC: 4)
  - [ ] Update sign-in page to use Supabase Auth
  - [ ] Update sign-up page to use Supabase Auth
  - [ ] Ensure proper error handling and validation
- [ ] Test authentication flows (AC: 4)
  - [ ] Test user registration flow
  - [ ] Test user login flow  
  - [ ] Test user logout flow
  - [ ] Test protected route access

## Dev Notes

### Previous Story Insights
No previous story exists - this is the first story in the project.

### Data Models
No specific data models are affected by this story. Supabase Auth manages the `auth.users` table automatically.
[Source: architecture/4-data-models.md - references to auth.users(id)]

### API Specifications
- Authentication will use Supabase Auth API endpoints automatically
- No custom API endpoints required for basic auth flows
- Future data operations will reference `auth.uid()` for user identification
[Source: architecture/11-backend-architecture.md#113-authentication-and-authorization-architecture]

### Component Specifications
- Sign-in/Sign-up forms should use React Hook Form with Zod validation
- Authentication components should follow established UI patterns with Shadcn-ui
- Error states and loading states must be properly handled
[Source: architecture/15-security-performance-and-standards.md#151-security-requirements]

### File Locations
Based on project structure:
- Authentication pages: `frontend/src/app/auth/sign-in/` and `frontend/src/app/auth/sign-up/`
- Middleware: `frontend/src/middleware.ts`
- Supabase client config: `frontend/src/lib/supabase.ts` (to be created)
- Authentication components: `frontend/src/components/auth/` (to be created)
[Source: architecture/12-unified-project-structure.md]

### Testing Requirements
- Unit tests for authentication components using Jest and React Testing Library
- Integration tests for auth flows using MSW for API mocking
- E2E tests for critical authentication workflows using Playwright
- Test coverage requirement for business logic components
[Source: architecture/15-security-performance-and-standards.md#153-testing-strategy]

### Technical Constraints
- TypeScript 5.x must be used with full type safety
- Next.js 14.x App Router architecture
- Supabase Auth integration with Row Level Security (RLS) preparation
- Environment variables must be properly configured and secured
- Input validation on both client and server sides required
[Source: architecture/3-tech-stack.md and architecture/15-security-performance-and-standards.md#151-security-requirements]

### Testing
**Test Framework:** Jest with React Testing Library for unit/integration tests, Playwright for E2E tests

**Test File Locations:** 
- Unit tests: `frontend/src/components/auth/__tests__/`
- Integration tests: `frontend/src/features/auth/__tests__/`
- E2E tests: `tests/e2e/auth/`

**Testing Standards:**
- High code coverage for authentication business logic
- Mock external Supabase calls using MSW
- Test error states and edge cases
- E2E tests must cover complete user registration and login flows

**Specific Testing Requirements:**
- Test form validation with invalid inputs
- Test successful and failed authentication attempts  
- Test middleware redirect behavior
- Test session persistence across page refreshes

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-02 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here after implementation*