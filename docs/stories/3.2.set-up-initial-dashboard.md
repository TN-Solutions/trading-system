# Story 3.2: Set up Initial Dashboard

## Status
Draft

## Story
**As a** user,
**I want** a welcome dashboard,
**so that** I have a focused starting point.

## Acceptance Criteria
1. Has a `/dashboard` page
2. Displays a welcome message
3. Has navigation shortcuts
4. Simple interface

## Tasks / Subtasks
- [ ] Create dashboard page route (AC: 1)
  - [ ] Create `/dashboard` page component following Next.js App Router pattern
  - [ ] Set up proper routing and page layout structure
  - [ ] Ensure dashboard page is properly protected by authentication middleware
  - [ ] Implement proper SEO metadata for dashboard page
- [ ] Build dashboard welcome section (AC: 2)
  - [ ] Create welcome message component with user personalization
  - [ ] Add greeting based on time of day and user name from Supabase Auth
  - [ ] Design welcome section layout using Shadcn-ui components
  - [ ] Include motivational content relevant to trading journaling
- [ ] Create navigation shortcuts component (AC: 3)
  - [ ] Build shortcut cards linking to main application features
  - [ ] Add shortcuts to Reports, Assets, Methodologies management pages
  - [ ] Implement shortcut cards with icons and descriptions
  - [ ] Add "Create New Report" quick action button
  - [ ] Include recent activity or quick stats if data exists
- [ ] Design simple and clean interface (AC: 4)
  - [ ] Implement dashboard layout using established design system
  - [ ] Create dashboard grid layout for responsive design
  - [ ] Add dashboard-specific styling following Tailwind CSS patterns
  - [ ] Ensure interface follows Shadcn-ui design consistency
  - [ ] Add proper loading states for dashboard components
- [ ] Implement dashboard data fetching (Supporting functionality)
  - [ ] Create server actions to fetch dashboard summary data
  - [ ] Implement user stats queries (report count, recent activity)
  - [ ] Add proper error handling for data fetching failures
  - [ ] Optimize dashboard data loading for performance
- [ ] Add comprehensive testing (Required by testing strategy)
  - [ ] Unit tests for dashboard components and welcome message
  - [ ] Integration tests for dashboard data fetching and user personalization
  - [ ] E2E tests for dashboard navigation and user flow

## Dev Notes

### Previous Story Insights
From Story 2.1: The authentication system with Supabase Auth is complete and working. The project uses TypeScript strict mode, Next.js 14 App Router, and Shadcn-ui components for consistent UI patterns. The feature-based architecture with server actions pattern is established and working well. All management pages (Assets, Methodologies, Reports) follow the same architectural patterns with protected routes under `/dashboard/*`. The middleware.ts file properly protects dashboard routes and redirects unauthenticated users to sign-in.

### Data Models
Dashboard will display user-specific data from existing models:
- **User Data**: Accessed via Supabase Auth (`auth.users`) for user name and profile information
- **Report Summary**: Count and recent reports from `reports` table with RLS filtering
- **Asset Count**: Number of user's assets from `assets` table 
- **Methodology Count**: Number of user's methodologies from `methodologies` table

No new database tables required - dashboard aggregates existing data.
[Source: architecture/4-data-models.md#41-43-models]

### API Specifications
Dashboard data operations use established Supabase client pattern:
- **Server Actions**: Follow established pattern: React component → Server Action → Supabase client → PostgreSQL
- **RLS Security**: All data queries automatically filtered by `(auth.uid() = user_id)` through existing RLS policies
- **Data Aggregation**: Server actions will aggregate counts and recent items for dashboard display
- **Authentication**: Dashboard page protected by existing middleware.ts authentication checks
- **Performance**: Dashboard queries should be optimized to avoid N+1 problems with proper joins
[Source: architecture/11-backend-architecture.md#authentication-and-authorization-architecture]

### Component Specifications
Dashboard follows established frontend architecture patterns:

**Page Structure:**
- `/dashboard` route using Next.js App Router at `frontend/src/app/dashboard/page.tsx`
- Server component for initial data fetching with proper loading states
- Follows existing dashboard layout structure under `/dashboard/*` routes

**Dashboard Components:**
- Welcome section with user greeting and personalized content
- Navigation shortcut cards using Shadcn-ui Card components
- Statistics summary cards for user data overview
- Quick action buttons for common workflows (Create Report)

**UI Library Usage:**
- Shadcn-ui components for consistent design (Card, Button, Typography)
- Tailwind CSS for responsive grid layout and styling
- Follow existing component patterns from Assets/Methodologies/Reports pages
- Proper loading states and error boundaries following established patterns

[Source: architecture/10-frontend-architecture.md#routing-and-component-architecture and architecture/6-components.md]

### File Locations
Based on established project structure:
- **Main Dashboard Page**: `frontend/src/app/dashboard/page.tsx` (already exists as route container)
- **Dashboard View Component**: `frontend/src/features/dashboard/page-views/dashboard-view.tsx`
- **Dashboard Components**: 
  - `frontend/src/features/dashboard/components/welcome-section.tsx`
  - `frontend/src/features/dashboard/components/navigation-shortcuts.tsx`
  - `frontend/src/features/dashboard/components/dashboard-stats.tsx`
- **Dashboard Server Actions**: `frontend/src/features/dashboard/actions/dashboard-actions.ts`
- **Dashboard Service**: `frontend/src/features/dashboard/services/dashboard-service.ts`
- **Dashboard Types**: `frontend/src/types/dashboard.ts`

New feature directory: `frontend/src/features/dashboard/` following established feature-based architecture
[Source: architecture/12-source-tree.md and architecture/10-frontend-architecture.md]

### Testing Requirements
Follow established testing pyramid approach:
- **Unit Tests**: Jest + React Testing Library for dashboard components
  - Test welcome message rendering and user personalization
  - Test navigation shortcuts functionality and routing
  - Test dashboard stats display and formatting
- **Integration Tests**: Test dashboard data fetching with MSW for Supabase API mocking
  - Test dashboard server actions and data aggregation
  - Test error states and loading states
- **E2E Tests**: Playwright for complete dashboard user workflow
  - Test dashboard as landing page after authentication
  - Test navigation from dashboard to feature pages
  - Test dashboard quick actions and shortcuts

**Test Locations**:
- Unit: `frontend/src/features/dashboard/components/__tests__/`
- Integration: `frontend/src/features/dashboard/__tests__/`
- E2E: `frontend/tests/e2e/dashboard/dashboard.spec.ts`
[Source: architecture/15-coding-standards.md#testing-strategy]

### Technical Constraints
- **TypeScript 5.x**: Strict mode with full type safety for dashboard data models
- **Next.js 14.x**: App Router architecture with server components for dashboard page
- **Authentication Middleware**: Dashboard protected by existing `frontend/src/middleware.ts`
- **Supabase Integration**: Row Level Security for all data queries automatically applied
- **Performance Optimization**: Use React Server Components for initial data loading
- **Responsive Design**: Dashboard must work on mobile and desktop using Tailwind CSS
- **Error Handling**: Proper error boundaries and loading states following project patterns
- **Navigation**: Integration with existing dashboard layout and navigation structure

[Source: architecture/3-tech-stack.md and architecture/15-coding-standards.md#coding-standards]

### Dashboard Content Specifications
Welcome dashboard should provide:
- **Personalized Greeting**: "Welcome back, [User Name]" with time-based greeting
- **Quick Stats**: Summary cards showing report count, asset count, methodology count
- **Navigation Shortcuts**: Cards linking to main features with descriptive icons
  - "Manage Reports" → `/dashboard/reports`
  - "Manage Assets" → `/dashboard/assets` 
  - "Manage Methodologies" → `/dashboard/methodologies`
- **Quick Actions**: "Create New Report" button for immediate access to core workflow
- **Recent Activity**: Optional recent reports or activity feed if data available
- **Simple Layout**: Clean, uncluttered interface focusing on getting users to their work quickly

### Security Requirements
Dashboard follows established security patterns:
- **Authentication Required**: Page protected by middleware.ts - unauthenticated users redirected
- **RLS Enforcement**: All data queries automatically filtered by user_id through existing policies
- **Server-side Rendering**: User data fetched server-side using Supabase service role
- **No Client-side Secrets**: All API calls through server actions, no exposed credentials
- **Input Validation**: Any user inputs (future search/filters) validated server-side
[Source: architecture/15-coding-standards.md#security-requirements]

### Performance Considerations
Dashboard optimized for fast loading:
- **Server Components**: Initial dashboard data fetched server-side for faster rendering
- **Minimal Client JavaScript**: Dashboard mostly static with targeted interactivity
- **Efficient Queries**: Dashboard data queries optimized with proper indexes and aggregation
- **Caching Strategy**: Consider caching dashboard stats for improved performance
- **Progressive Enhancement**: Core dashboard functionality works without JavaScript
[Source: architecture/15-coding-standards.md#performance-optimization]

### Project Structure Notes
Dashboard implementation creates new feature directory following established patterns. All existing `/dashboard/*` routes remain unchanged. The dashboard serves as the main landing page after authentication, providing clear navigation to all application features. Implementation follows the same component architecture as existing features with page-views, components, actions, and services separation.

## Testing

**Test Framework:** Jest with React Testing Library for unit/integration tests, Playwright for E2E tests

**Test File Locations:**
- Unit tests: `frontend/src/features/dashboard/components/__tests__/`
- Integration tests: `frontend/src/features/dashboard/__tests__/`
- E2E tests: `frontend/tests/e2e/dashboard/dashboard.spec.ts`

**Testing Standards:**
- High code coverage for dashboard business logic and user personalization
- Mock Supabase calls using MSW for integration tests
- Test error states and loading states for data fetching
- E2E tests must cover dashboard as entry point and navigation workflows

**Specific Testing Requirements:**
- Test welcome message personalization with different user data
- Test navigation shortcuts linking to correct routes
- Test dashboard stats display with various data states (empty, populated)
- Test authentication protection (redirect to sign-in for unauthenticated users)
- Test responsive design on different screen sizes
- Test error handling for failed data fetching
- Test loading states during dashboard data loading
- Test quick action buttons functionality and navigation
- Test dashboard as landing page after successful authentication
- Test integration with existing dashboard layout and navigation
- Validate dashboard performance and loading times
- Test accessibility compliance for dashboard components

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-08-04 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be filled by development agent_

### Debug Log References
_To be filled by development agent_

### Completion Notes List
_To be filled by development agent_

### File List
_To be filled by development agent_

## QA Results
_To be filled by QA agent_